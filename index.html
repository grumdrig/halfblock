<!DOCTYPE html>
<html>

<head>
<title>MC lite</title>
<script type="text/javascript" src="gl-matrix.js"></script>
<script type="text/javascript" src="webgl-utils.js"></script>
<script type="text/javascript" src="perlin.js"></script>
<script type="text/javascript" src="main.js"></script>

<!-- Shaders for wireframe selection box -->
<script id="wireframe-vs" type="x-shader/x-vertex">
  attribute vec3 aPos;

  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;

  void main(void) {
    gl_Position = uPMatrix * uMVMatrix * vec4(aPos, 1.0);
  }
</script>
<script id="wireframe-fs" type="x-shader/x-fragment">
  precision mediump float;

  void main(void) {
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
  }
</script>

<!-- Shaders for particles -->
<script id="particle-vs" type="x-shader/x-vertex">
  attribute vec3 aInitialPos;
  attribute vec3 aVelocity;
  attribute float aBirthday;
  //attribute float aDeathday;
  uniform float uClock;
  uniform float uGravity;
  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;

  void main(void) {
    if (aBirthday > uClock /*|| uClock > aDeathday*/) {
      gl_Position = vec4(-9999.0, -9999.0, -9999.0, 1.0);
    } else {
      float age = uClock - aBirthday;
      vec3 pos = aInitialPos + age * aVelocity;
      pos.y -= 0.5 * uGravity * age * age;  // reduced gravity
      if (uClock == aBirthday) pos.y += 3.0;
      gl_Position = uPMatrix * uMVMatrix * vec4(pos, 1.0);
      gl_PointSize = clamp(50.0 / gl_Position.z, 1.0, 50.0);
    }
  }
</script>
<script id="particle-fs" type="x-shader/x-fragment">
  precision mediump float;
  void main(void) {
    gl_FragColor = vec4(0.5, 0.35, 0.25, 1.0);
  }
</script>

<!-- Block shader -->
<script id="shader-vs" type="x-shader/x-vertex">
  attribute vec3 aVertexPosition;
  attribute vec2 aTextureCoord;
  attribute vec3 aLighting;
  
  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;
  
  varying vec2 vTextureCoord;
  varying vec3 vLighting;
  varying float vFog;
  
  const float fogDistance = 20.0;
  
  void main(void) {
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
    vTextureCoord = aTextureCoord / 16.0;
    vLighting = aLighting;
    float z = abs(gl_Position.z);  // Use length() if not enough fog at corners
    vFog = clamp(1.0 - exp(-z * z / (fogDistance * fogDistance)), 0.0, 1.0);
  }
</script>
<script id="shader-fs" type="x-shader/x-fragment">
  precision mediump float;

  varying vec2 vTextureCoord;
  varying vec3 vLighting;
  varying float vFog;
  
  uniform sampler2D uSampler;

  void main(void) {
    vec4 textureColor = texture2D(uSampler, vTextureCoord);
    if (textureColor.a <= 0.5) {
      discard;
    } else {
      textureColor = vec4(textureColor.rgb * vLighting, textureColor.a);
      textureColor = vFog * vec4(0.5,0.8,0.98,0) + (1.0 - vFog) * textureColor;
      gl_FragColor = textureColor;
    }
  }
</script>

<script id="twodee-vs" type="x-shader/x-vertex">
  attribute vec2 a_position;
  uniform vec2 u_resolution;
  uniform float u_pointsize;
  void main() {
    gl_PointSize = u_pointsize;
    vec2 reposition = 2.0 * a_position / u_resolution - 1.0;
    resposition.y = -reposition.y;
    gl_Position = vec4(reposition, 0, 1);
  }
</script>
<script id="twodee-fs" type="x-shader/x-fragment">
  precision mediump float;
  uniform vec4 u_color;
  void main() {
    gl_FragColor = u_color;
  }
</script>

<style>
body {
  height: 100%;
  width: 100%;
  margin: auto;
  margin-top: 20px;
  background-color: black;
}

#cancan {
  position: relative;
  margin: auto auto;
}

#canvas, #cancan, #hud, #stats {
  width: 640px;
  height: 480px;
}

#hud {
  font-family: Inconsolata, Helvetica;
  font-size: 18px;
  position: absolute;
  top: 0;
  left: 0;
  color: white;
}

#stats {
  position: absolute;
  left: 0;
  top: 0;
}

#reticule {
  position: absolute;
  left: 308px;
  top: 228px;
  width: 24px;
  height: 24px;
}

#warning {
  position: absolute;
  left: 0;
  top: 260px;
  width: 640px;
  height: 48px;
  font-size: 20px;
  color: red;
  text-align: center;
}

#inventory {
  position: absolute;
  left: 16px;
  top: 412px;
  width: 48px;
  height: 48px;
  border: solid 2px rgb(128, 128, 128);
  background: rgba(128, 128, 128, 0.5);
}

#toolname {
  position: absolute;
  height: 16px;
  width: 100px;
  left: 16px;
  top: 390px;
}

#tool {
  background: transparent;
}

#terrain {
  display: none;
}

</style>
</head>


<body onload="onLoad()">
  <div id="cancan">
    <canvas id="canvas" width="640" height="480"></canvas>
    <div id="hud">
      <div id="stats"></div>
      <div id="reticule">
        <img src="reticule.png" height="24" width="24">
      </div>
      <div id="toolname"></div>
      <div id="inventory">
        <canvas id="tool" width="48" height="48"></canvas>
      </div>
      <div id="warning">&uarr;<br>CENTER MOUSE POINTER TO ENABLE MOUSELOOK</div>
    </div>
  </div>
  <img src="terrain.png" id="terrain">
</body>

</html>
